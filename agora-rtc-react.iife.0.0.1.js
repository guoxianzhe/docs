
/**
 * @license agora-rtc-react
 * @version 0.0.1
 *
 * Copyright (c) Agora, Inc.
 *
 * This source code is licensed under the MIT license.
 */

"use strict";var AgoraRTCReact=(()=>{var Ye=Object.create;var Z=Object.defineProperty;var Je=Object.getOwnPropertyDescriptor;var Ze=Object.getOwnPropertyNames;var ze=Object.getPrototypeOf,Ke=Object.prototype.hasOwnProperty;var z=(e,r)=>()=>(r||e((r={exports:{}}).exports,r),r.exports),Xe=(e,r)=>{for(var o in r)Z(e,o,{get:r[o],enumerable:!0})},xe=(e,r,o,t)=>{if(r&&typeof r=="object"||typeof r=="function")for(let n of Ze(r))!Ke.call(e,n)&&n!==o&&Z(e,n,{get:()=>r[n],enumerable:!(t=Je(r,n))||t.enumerable});return e};var c=(e,r,o)=>(o=e!=null?Ye(ze(e)):{},xe(r||!e||!e.__esModule?Z(o,"default",{value:e,enumerable:!0}):o,e)),er=e=>xe(Z({},"__esModule",{value:!0}),e);var C=z((Vr,Ne)=>{Ne.exports=React});var Ue=z(ee=>{"use strict";var ar=C(),lr=Symbol.for("react.element"),sr=Symbol.for("react.fragment"),cr=Object.prototype.hasOwnProperty,ur=ar.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,dr={key:!0,ref:!0,__self:!0,__source:!0};function Le(e,r,o){var t,n={},s=null,a=null;o!==void 0&&(s=""+o),r.key!==void 0&&(s=""+r.key),r.ref!==void 0&&(a=r.ref);for(t in r)cr.call(r,t)&&!dr.hasOwnProperty(t)&&(n[t]=r[t]);if(e&&e.defaultProps)for(t in r=e.defaultProps,r)n[t]===void 0&&(n[t]=r[t]);return{$$typeof:lr,type:e,key:s,ref:a,props:n,_owner:ur.current}}ee.Fragment=sr;ee.jsx=Le;ee.jsxs=Le});var v=z((Wr,Pe)=>{"use strict";Pe.exports=Ue()});var W=z((To,Fe)=>{Fe.exports=AgoraRTC});var wr={};Xe(wr,{AgoraRTCProvider:()=>fr,AgoraRTCReactError:()=>g,AgoraRTCScreenShareProvider:()=>mr,LocalAudioTrack:()=>Ie,LocalUser:()=>Ur,LocalVideoTrack:()=>ye,RemoteAudioTrack:()=>ke,RemoteUser:()=>Pr,RemoteVideoTrack:()=>be,TrackBoundary:()=>hr,VERSION:()=>Dr,useAutoPlayAudioTrack:()=>Y,useAutoPlayVideoTrack:()=>G,useClientEvent:()=>nr,useConnectionState:()=>Tr,useCurrentUID:()=>Rr,useIsConnected:()=>k,useJoin:()=>gr,useLocalCameraTrack:()=>kr,useLocalMicrophoneTrack:()=>Ar,useNetworkQuality:()=>vr,usePublish:()=>Ir,useRTCClient:()=>I,useRTCScreenShareClient:()=>Cr,useRemoteAudioTracks:()=>br,useRemoteUserTrack:()=>de,useRemoteUsers:()=>xr,useRemoteVideoTracks:()=>Er,useTrackEvent:()=>ir,useVolumeLevel:()=>yr});var j=c(C());function T(e,r,o){return e.on(r,o),()=>e.off(r,o)}var x=c(C());function rr(e){try{return e()}catch(r){console.error(r)}}function h(e){return()=>e.forEach(rr)}function he(e,r){let o=setInterval(e,r);return()=>clearInterval(o)}function D(e,r){let o=setTimeout(e,r);return()=>clearTimeout(o)}function K(){let e,r,o;function t(){if(r){let f=r;r=void 0,f()}}async function n(){if(o){let f=o;o=void 0;try{await f()}catch(d){console.error(d)}}}async function s(f){e=!0,await n();try{o=await f()}catch(d){console.error(d)}e=!1,t()}async function a(){e=!0,await n(),e=!1,t()}function m(f){e?r=()=>s(f):s(f)}function p(){e?r=a:a()}return{run:m,dispose:p}}var B=typeof document<"u"?x.useLayoutEffect:x.useEffect;function or(e){return e!=null&&typeof e.then=="function"}function N(){let e=(0,x.useRef)(!1);return(0,x.useEffect)(()=>(e.current=!1,()=>{e.current=!0}),[]),e}function tr(){let e=N();function r(o,t){return new Promise(async(n,s)=>{try{let a=await o;e.current||n(a)}catch(a){e.current?t&&t(a):s(a)}})}return(0,x.useCallback)(r,[e])}function X(e){let r=tr(),[o,t]=(0,x.useState)();return B(()=>{or(e)?r(e).then(t):t(e)},[e,r]),o}function S(e,r){let o=(0,x.useRef)();(0,x.useEffect)(()=>{let{run:t,dispose:n}=o.current||=K();return t(e),n},r)}function Se(e,r){let o=e.split("."),t=r.split("."),n=Math.max(o.length,t.length);for(let s=0;s<n;s++){let a=parseInt(o[s]||"0"),m=parseInt(t[s]||"0");if(a>m)return 1;if(a<m)return-1}return 0}function nr(e,r,o){let t=(0,j.useRef)(o);B(()=>{t.current=o},[o]),(0,j.useEffect)(()=>{if(e)return T(e,r,(...n)=>{t.current&&t.current(...n)})},[r,e])}function ir(e,r,o){let t=(0,j.useRef)(o);B(()=>{t.current=o},[o]),(0,j.useEffect)(()=>{if(e)return T(e,r,(...n)=>{t.current&&t.current(...n)})},[r,e])}var re=c(C()),we=c(v()),De=(0,re.createContext)(null);function fr({client:e,children:r}){return(0,we.jsx)(De.Provider,{value:e,children:r})}function pr(e){let r=(0,re.useContext)(De);return e||r}function I(e){let r=pr(e);if(!r)throw new Error("Agora RTC client not found. Should be wrapped in <AgoraRTCProvider value={client} />");return r}var oe=c(C()),Ve=c(v()),Me=(0,oe.createContext)(null);function mr({client:e,children:r}){return(0,Ve.jsx)(Me.Provider,{value:e,children:r})}function Cr(e){let r=(0,oe.useContext)(Me);return e||r}var te=c(C());function Tr(e){let r=I(e),[o,t]=(0,te.useState)(r?r.connectionState:"DISCONNECTED");return(0,te.useEffect)(()=>{if(r){t(r.connectionState);let n;return h([T(r,"connection-state-change",s=>{n?.(),s==="CONNECTED"?n=D(()=>t(s),0):t(s)}),()=>n?.()])}else t("DISCONNECTED")},[r]),o}var ne=c(C());function k(e){let r=I(e),[o,t]=(0,ne.useState)(r?r.connectionState==="CONNECTED":!1);return(0,ne.useEffect)(()=>{if(r){t(r.connectionState==="CONNECTED");let n;return h([T(r,"connection-state-change",s=>{n?.(),n=D(()=>t(s==="CONNECTED"),0)}),()=>n?.()])}else t(!1)},[r]),o}var ie=c(C());function Rr(e){let r=I(e),[o,t]=(0,ie.useState)(r?.uid);return(0,ie.useEffect)(()=>{if(r)return T(r,"connection-state-change",n=>{if(n==="CONNECTED")return D(()=>t(r.uid),0);n==="DISCONNECTED"&&t(void 0)})},[r]),o}var ae=c(C());var g=class extends Error{rtcMethod;rtcError;name="AgoraRTCReactException";constructor(r,o){typeof o=="string"?super(o):super(o.message),this.rtcMethod=r,this.rtcError=o}log(r){console[r](this)}};function gr(e,r=!0,o){let t=I(o),n=k(o),[s,a]=(0,ae.useState)(!1),[m,p]=(0,ae.useState)(0),[f,d]=(0,ae.useState)(null),u=N();return S(async()=>{if(u.current||(d(null),p(0),a(!1)),r&&t){try{u.current||a(!0);let{appid:y,channel:A,token:E,uid:i}=typeof e=="function"?await e():e,l=await t.join(y,A,E,i);u.current||p(l)}catch(y){console.error(y),u.current||d(new g("IAgoraRTCClient.join",y))}return u.current||a(!1),()=>{for(let y of t.localTracks)y.isPlaying&&y.stop(),y.close();return t.leave()}}},[r,o]),{data:m,isLoading:s,isConnected:n,error:f}}var le=c(C());var Oe=()=>({uplink:0,downlink:0,delay:0});function vr(e){let r=I(e),[o,t]=(0,le.useState)(Oe);return(0,le.useEffect)(()=>{if(r)return T(r,"network-quality",n=>t({uplink:n.uplinkNetworkQuality,downlink:n.downlinkNetworkQuality,delay:r.getRTCStats().RTT??0}));t(Oe())},[r]),o}var _e=c(W()),q=c(C());function Ir(e,r=!0,o){let t=I(o),n=k(o),s=(0,q.useRef)([]),[a,m]=(0,q.useState)(!1),[p,f]=(0,q.useState)(null),d=N();return S(async()=>{if(d.current||(m(!1),f(null)),!t||!n||!r)return;let u=e.filter(Boolean),y=i=>{let l=Se(_e.default.VERSION,"4.18.1")>=0;return l||new g("usePublish","please check your agora-rtc-sdk-ng version in package.json, it's recommend upgrade to >= 4.18.1").log("warn"),l?t.mode!=="live"||t.role!=="audience":!0},A=i=>s.current.some(l=>l&&l.getTrackId()===i.getTrackId()),E=i=>y(i)&&i.enabled&&r&&!A(i);for(let i=0;i<u.length;i++){let l=u[i];if(l&&E(l)){try{d.current||m(!0),await t.publish(l)}catch(R){console.error(R),d.current||f(new g("IAgoraRTCClient.publish",R))}d.current||m(!1)}}s.current=u},[n,r,t,e]),{isLoading:a,error:p}}var se=c(C());function yr(e){let[r,o]=(0,se.useState)(0);return(0,se.useEffect)(()=>{if(e)return he(()=>{o(e.getVolumeLevel())},1e3)},[e]),r}var Be=c(W()),ce=c(C());function Ar(e=!0,r={ANS:!0,AEC:!0},o){let t=k(o),[n,s]=(0,ce.useState)(null),[a,m]=(0,ce.useState)(!1),[p,f]=(0,ce.useState)(null),d=N();return S(async()=>{if(t&&e&&!n){try{d.current||m(!0);let u=await Be.default.createMicrophoneAudioTrack(r);d.current||s(u)}catch(u){console.error(u),d.current||f(new g("IAgoraRTC.createMicrophoneAudioTrack",u))}d.current||m(!1)}!t&&!d.current&&s(null)},[t,e]),{localMicrophoneTrack:n,isLoading:a,error:p}}var je=c(W()),ue=c(C());function kr(e=!0,r){let o=k(r),[t,n]=(0,ue.useState)(null),[s,a]=(0,ue.useState)(!1),[m,p]=(0,ue.useState)(null),f=N();return S(async()=>{if(f.current||(a(!1),p(null)),o&&e&&!t){try{f.current||a(!0);let d=await je.default.createCameraVideoTrack();f.current||n(d)}catch(d){console.error(d),f.current||p(new g("IAgoraRTC.createCameraVideoTrack",d))}f.current||a(!1)}!o&&!f.current&&n(null)},[o,e]),{localCameraTrack:t,isLoading:s,error:m}}var H=c(C());function br(e,r){let o=I(r),[t,n]=(0,H.useState)([]),s=k(),a=(0,H.useRef)([]),[m,p]=(0,H.useState)(!1),[f,d]=(0,H.useState)(null),u=N();return S(async()=>{if(u.current||d(null),!Array.isArray(e)||!s)return;let y=async i=>{if(!i.audioTrack&&e.some(({uid:l})=>i.uid===l)){try{u.current||p(!0),await o.subscribe(i,"audio")}catch(l){console.error(l),u.current||d(new g("IAgoraRTCClient.subscribe",l))}i.audioTrack&&!a.current.some(l=>l.getUserId()===i.uid)&&a.current.push(i.audioTrack),a.current=a.current.map(l=>i.audioTrack&&l.getUserId()===i.uid&&l.getTrackId()!==i.audioTrack.getTrackId()?i.audioTrack:l),u.current||(n(a.current),p(!1))}},A=async i=>{if(e.some(({uid:l})=>i.uid===l)){u.current||(a.current=a.current.filter(l=>l.getUserId()!==i.uid),n(a.current));try{u.current||p(!0),await o.unsubscribe(i,"audio")}catch(l){console.error(l),u.current||d(new g("IAgoraRTCClient.unsubscribe",l))}u.current||p(!1)}};e.map(i=>{!i.audioTrack&&i.hasAudio&&y(i)});let E=[];for(let i=0;i<a.current.length;i++){let l=a.current[i];if(!e.some(R=>R.uid===l.getUserId())){let R=o.remoteUsers.find(P=>P.uid===l.getUserId());R&&(E.push({user:R,mediaType:"audio"}),a.current.splice(i,1),i--)}}if(E.length>0){try{u.current||p(!0),await o.massUnsubscribe(E)}catch(i){console.error(i),u.current||d(new g("IAgoraRTCClient.massUnsubscribe",i))}u.current||(n(a.current.slice()),p(!1))}return h([T(o,"user-published",(i,l)=>{e.find(R=>R.uid===i.uid)&&l==="audio"&&y(i)}),T(o,"user-unpublished",(i,l)=>{e.find(R=>R.uid===i.uid)&&l==="audio"&&A(i)})])},[s,o,e]),{audioTracks:t,isLoading:m,error:f}}var Q=c(C());function Er(e,r){let o=I(r),[t,n]=(0,Q.useState)([]),s=k(),a=(0,Q.useRef)([]),[m,p]=(0,Q.useState)(!1),[f,d]=(0,Q.useState)(null),u=N();return S(async()=>{if(u.current||d(null),!Array.isArray(e)||!s)return;let y=async i=>{if(!i.videoTrack&&e.some(({uid:l})=>i.uid===l)){try{u.current||p(!0),await o.subscribe(i,"video")}catch(l){console.error(l),u.current||d(new g("IAgoraRTCClient.subscribe",l))}i.videoTrack&&!a.current.some(l=>l.getUserId()===i.uid)&&a.current.push(i.videoTrack),a.current=a.current.map(l=>i.videoTrack&&l.getUserId()===i.uid&&l.getTrackId()!==i.videoTrack.getTrackId()?i.videoTrack:l),u.current||(n(a.current),p(!1))}},A=async i=>{if(e.some(({uid:l})=>i.uid===l)){u.current||(a.current=a.current.filter(l=>l.getUserId()!==i.uid),n(a.current));try{u.current||p(!0),await o.unsubscribe(i,"video")}catch(l){console.error(l),u.current||d(new g("IAgoraRTCClient.unsubscribe",l))}u.current||p(!1)}};e.map(i=>{!i.videoTrack&&i.hasVideo&&y(i)});let E=[];for(let i=0;i<a.current.length;i++){let l=a.current[i];if(!e.some(R=>R.uid===l.getUserId())){let R=o.remoteUsers.find(P=>P.uid===l.getUserId());R&&(E.push({user:R,mediaType:"video"}),a.current.splice(i,1),i--)}}if(E.length>0){try{u.current||p(!0),await o.massUnsubscribe(E)}catch(i){console.error(i),u.current||d(new g("IAgoraRTCClient.massUnsubscribe",i))}u.current||(n(a.current.slice()),p(!1))}return h([T(o,"user-published",(i,l)=>{e.find(R=>R.uid===i.uid)&&l==="video"&&y(i)}),T(o,"user-unpublished",(i,l)=>{e.find(R=>R.uid===i.uid)&&l==="video"&&A(i)})])},[s,o,e]),{videoTracks:t,isLoading:m,error:f}}var w=c(C());function de(e,r,o){let t=I(o),n=r==="audio"?"audioTrack":"videoTrack",[s,a]=(0,w.useState)(e&&e[n]),m=k(),p=(0,w.useRef)(),[f,d]=(0,w.useState)(!1),[u,y]=(0,w.useState)(null);return(0,w.useEffect)(()=>{if(!e||!m)return;let A=!1;A||y(null);let E=r==="audio"?"hasAudio":"hasVideo",i=e.uid,l=async(b,O)=>{if(b[n]&&t.remoteUsers.some(({uid:U})=>b.uid===U))try{A||d(!0),await t.unsubscribe(b,O)}catch(U){A||y(new g("IAgoraRTCClient.unsubscribe",U)),console.error(U)}A||(a(void 0),d(!1))},R=async(b,O)=>{try{!b[n]&&t.remoteUsers.some(({uid:U})=>b.uid===U)&&(A||d(!0),await t.subscribe(b,O)),A||a(b[n])}catch(U){A||y(new g("IAgoraRTCClient.subscribe",U)),console.error(U)}A||d(!1)},P=p.current||=K();return!e[n]&&e[E]?P.run(()=>R(e,r)):a(e[n]),h([()=>{A=!0,P.dispose()},T(t,"user-published",(b,O)=>{b.uid===i&&O===r&&P.run(()=>R(b,r))}),T(t,"user-unpublished",(b,O)=>{b.uid===i&&O===r&&P.run(()=>l(b,r))})])},[m,t,e,r,n]),{track:s,isLoading:f,error:u}}var fe=c(C());function xr(e){let r=I(e),[o,t]=(0,fe.useState)(r?r.remoteUsers:[]);return(0,fe.useEffect)(()=>{if(r){let n=()=>t(r.remoteUsers.slice());return h([T(r,"user-joined",n),T(r,"user-left",n),T(r,"user-published",n),T(r,"user-unpublished",n)])}},[r]),o}var pe=c(C());var L=c(C());var He=c(v());function Nr(){let e=new Map,r=1500;return{onMount:o=>{let t=e.get(o);t&&(t(),e.delete(o))},onUnmount:o=>{let t=e.get(o);t&&t(),e.set(o,D(()=>{o.isPlaying&&o.stop(),e.delete(o)},r))},dispose:()=>{for(let[o,t]of e)o.isPlaying&&o.stop(),t&&t();e.clear()}}}var ve=(0,L.createContext)(void 0);function hr({children:e}){let[r]=(0,L.useState)(Nr);return(0,L.useEffect)(()=>r.dispose,[r]),(0,He.jsx)(ve.Provider,{value:r,children:e})}function G(e,r,o){let t=(0,L.useContext)(ve);(0,L.useEffect)(()=>{if(e)return o&&r?e.play(o):e.stop(),t?(t.onMount(e),()=>t.onUnmount(e)):()=>{e.isPlaying&&e.stop()}},[e,o,r,t])}function Y(e,r){let o=(0,L.useContext)(ve);B(()=>{if(e)return r?e.play():e.stop(),o?(o.onMount(e),()=>o.onUnmount(e)):()=>{e.isPlaying&&e.stop()}},[e,r,o])}var me=c(v());function Ie({track:e,play:r=!1,volume:o,disabled:t,muted:n,children:s}){let a=X(e);return Y(a,r),(0,pe.useEffect)(()=>{a&&o!=null&&a.setVolume(o)},[a,o]),(0,pe.useEffect)(()=>{a&&t!=null&&a.setEnabled(!t).catch(console.warn)},[t,a]),(0,pe.useEffect)(()=>{a&&n!=null&&a.setMuted(n).catch(console.warn)},[n,a]),s?(0,me.jsx)(me.Fragment,{children:s}):null}var J=c(C());var Qe=c(C()),Ce={position:"relative",width:"100%",height:"100%",overflow:"hidden",background:"#000"},Te={width:"100%",height:"100%"},$={position:"absolute",top:0,left:0,width:"100%",height:"100%",overflow:"hidden",zIndex:2},M=(e,r)=>(0,Qe.useMemo)(()=>({...e,...r}),[e,r]);var $e=c(v());function ye({track:e,play:r,disabled:o,muted:t,style:n,...s}){let a=M(Te,n),[m,p]=(0,J.useState)(null),f=X(e);return G(f,r,m),(0,J.useEffect)(()=>{f&&o!=null&&f.setEnabled(!o).catch(console.warn)},[o,f]),(0,J.useEffect)(()=>{f&&t!=null&&f.setMuted(t).catch(console.warn)},[t,f]),(0,$e.jsx)("div",{...s,ref:p,style:a})}var V=c(v()),Sr={width:"100%",height:"100%",background:"#1a1e21 center/cover no-repeat",filter:"blur(16px) brightness(0.4)"},Lr={position:"absolute",top:"50%",left:"50%",maxWidth:"50%",maxHeight:"50%",aspectRatio:"1",transform:"translate(-50%, -50%)",borderRadius:"50%",overflow:"hidden",objectFit:"cover"};function Re({cover:e}){return(0,V.jsx)("div",{style:$,children:typeof e=="string"?(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)("div",{style:{...Sr,backgroundImage:`url(${e})`}}),(0,V.jsx)("img",{src:e,style:Lr})]}):e()})}var F=c(v());function Ur({micOn:e,cameraOn:r,audioTrack:o,videoTrack:t,playAudio:n,playVideo:s,volume:a,cover:m,children:p,style:f,...d}){let u=M(Ce,f);return s=s??!!r,n=n??!!e,(0,F.jsxs)("div",{...d,style:u,children:[(0,F.jsx)(ye,{disabled:!r,play:s,track:t}),(0,F.jsx)(Ie,{disabled:!e,play:n,track:o,volume:a}),m&&!r&&(0,F.jsx)(Re,{cover:m}),(0,F.jsx)("div",{style:$,children:p})]})}var Ae=c(C());var ge=c(v());function ke({track:e,play:r=!1,playbackDeviceId:o,volume:t,children:n}){return Y(e,r),(0,Ae.useEffect)(()=>{e&&o!=null&&e.setPlaybackDevice(o).catch(console.warn)},[e,o]),(0,Ae.useEffect)(()=>{e&&t!=null&&e.setVolume(t)},[e,t]),n?(0,ge.jsx)(ge.Fragment,{children:n}):null}var We=c(C());var qe=c(v());function be({track:e,play:r,style:o,...t}){let n=M(Te,o),[s,a]=(0,We.useState)(null);return G(e,r,s),(0,qe.jsx)("div",{...t,ref:a,style:n})}var _=c(v());function Pr({user:e,playVideo:r,playAudio:o,playbackDeviceId:t,volume:n,cover:s,style:a,children:m,...p}){let f=M(Ce,a),{track:d}=de(e,"video"),{track:u}=de(e,"audio");return r=r??e?.hasVideo,o=o??e?.hasAudio,(0,_.jsxs)("div",{...p,style:f,children:[(0,_.jsx)(be,{play:r,track:d}),(0,_.jsx)(ke,{play:o,playbackDeviceId:t,track:u,volume:n}),s&&!r&&(0,_.jsx)(Re,{cover:s}),(0,_.jsx)("div",{style:$,children:m})]})}var Ge=c(W()),Ee=class{appType=1001;constructor(){Ge.default.setAppType(this.appType)}};new Ee;var Dr="1.1.0";return er(wr);})();
/*! Bundled license information:

react/cjs/react-jsx-runtime.production.min.js:
  (**
   * @license React
   * react-jsx-runtime.production.min.js
   *
   * Copyright (c) Facebook, Inc. and its affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)
*/
